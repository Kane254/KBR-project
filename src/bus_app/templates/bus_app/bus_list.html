{# bus_app/templates/bus_app/bus_list.html #}
{% extends 'bus_app/base.html' %}

{% block title %}Available Trips{% endblock %}

{% block content %}
    <h1>Available Bus Trips</h1>

    <form method="GET" action="{% url 'bus_list' %}">
        {{ form.as_p }}
        <button type="submit">Search Trips</button>
    </form>

    {% if trips %}
        <table>
            <thead>
                <tr>
                    <th>Route</th>
                    <th>Bus Number</th>
                    <th>Departure Time</th>
                    <th>Fare</th>
                    <th>Available Seats</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for trip in trips %}
                    <tr>
                        <td>{{ trip.route.origin }} to {{ trip.route.destination }}</td>
                        <td>{{ trip.bus.bus_number }}</td>
                        <td>{{ trip.departure_time|date:"Y-m-d H:i" }}</td>
                        <td>Ksh {{ trip.fare }}</td>
                        <td>{{ trip.available_seats }}</td>
                        <td>
                            {% if trip.available_seats > 0 %}
                                <a href="{% url 'book_trip' trip.id %}">Book Now</a>
                            {% else %}
                                Fully Booked
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No bus trips found matching your criteria or currently available.</p>
    {% endif %}
{% endblock %}